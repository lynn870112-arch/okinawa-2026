<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="æ²–ç¹©2026">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/826/826070.png">
    <link rel="manifest" href="manifest.json">
    <title>æ²–ç¹©æ¥µè‡´ä¹‹æ—… 2026</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@700&family=Noto+Sans+TC:wght@400;500;700&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #fcfaf2; color: #4a4a4a; -webkit-tap-highlight-color: transparent; }
        h2, .font-serif { font-family: 'Noto Serif TC', serif; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .active-date .date-num { color: #e53e3e; font-weight: bold; }
        .active-date .date-dot { background-color: #e53e3e; }
        .timeline-wrapper { position: relative; width: 100%; min-height: 200px; }
        .timeline-line { position: absolute; left: 19px; top: 10px; bottom: 20px; width: 2px; background-color: #e2e8f0; z-index: 0; }
        .timeline-dot { z-index: 10; background-color: #fff; border: 2px solid #e53e3e; width: 12px; height: 12px; border-radius: 50%; position: absolute; left: 14px; top: 8px; }
        .sub-card { background-color: #ffffff; border-left: 4px solid #fca5a5; margin-left: 1rem; margin-top: 0.5rem; padding: 0.7rem; border-radius: 0.5rem; box-shadow: 0 1px 3px rgba(0,0,0,0.03); cursor: pointer; }
        .nav-btn-active { color: #e53e3e !important; }
        .weather-badge { background: rgba(255,255,255,0.6); backdrop-blur: sm; border-radius: 12px; padding: 4px 10px; border: 1px solid rgba(255,255,255,0.3); }
    </style>
</head>
<body class="flex flex-col h-screen overflow-hidden">

    <header id="app-header" class="bg-[#fcfaf2] pt-4 pb-3 px-5 sticky top-0 z-30 shadow-sm border-b border-orange-50 flex-shrink-0 text-center">
        <div id="countdown" class="text-[9px] font-bold text-red-500 text-center mb-1 tracking-widest uppercase"></div>
        <div class="text-center mb-3">
            <h1 class="text-[8px] tracking-[0.2em] text-gray-400 font-bold uppercase">PREMIUM TRAVEL GUIDE</h1>
            <h2 class="text-xl font-bold text-gray-800">æ²–ç¹©æ¥µè‡´ä¹‹æ—… <span class="text-xs font-normal text-gray-400 bg-gray-100 px-1.5 py-0.5 rounded-full">2026</span></h2>
        </div>

        <div class="flex justify-center gap-3 mb-4" id="weather-info">
            <div class="weather-badge flex items-center gap-2">
                <span class="text-[10px] font-bold text-gray-400">TODAY</span>
                <i id="w-icon-0" class="fas fa-circle-notch fa-spin text-orange-400 text-xs"></i>
                <span id="w-temp-0" class="text-xs font-mono font-bold text-gray-600">--Â°</span>
            </div>
            <div class="weather-badge flex items-center gap-2">
                <span class="text-[10px] font-bold text-gray-400">TOMO</span>
                <i id="w-icon-1" class="fas fa-circle-notch fa-spin text-blue-400 text-xs"></i>
                <span id="w-temp-1" class="text-xs font-mono font-bold text-gray-600">--Â°</span>
            </div>
        </div>
        
        <div class="relative flex justify-center items-end min-h-[42px]">
            <div id="date-picker-container" class="flex space-x-5"></div>
            <div class="absolute right-0 flex space-x-4 items-end pb-0.5">
                <button onclick="toggleView('checklist')" id="checklist-toggle" class="flex flex-col items-center text-gray-300 transition-all">
                    <i class="fas fa-clipboard-list text-lg mb-0.5"></i>
                    <span class="text-[9px] font-bold">æ¸…å–®</span>
                </button>
                <button onclick="toggleView('ledger')" id="ledger-toggle" class="flex flex-col items-center text-gray-300 transition-all">
                    <i class="fas fa-wallet text-lg mb-0.5"></i>
                    <span class="text-[9px] font-bold">å¸³æœ¬</span>
                </button>
            </div>
        </div>
    </header>

    <main id="content" class="flex-1 overflow-y-auto p-5 pb-24 bg-[#fcfaf2]"></main>

    <div id="detail-modal" class="fixed inset-0 bg-black bg-opacity-60 z-50 hidden flex items-end sm:items-center justify-center transition-opacity duration-300 opacity-0">
        <div class="bg-white w-full sm:max-w-md sm:rounded-2xl rounded-t-3xl overflow-hidden max-h-[85vh] flex flex-col transform translate-y-full transition-transform duration-300 ease-out">
            <div class="relative h-56 flex-shrink-0">
                <img id="modal-img" src="" class="w-full h-full object-cover">
                <button onclick="closeModal()" class="absolute top-4 right-4 bg-black bg-opacity-40 text-white rounded-full p-2 backdrop-blur-sm"><i class="fas fa-xmark"></i></button>
            </div>
            <div class="p-6 overflow-y-auto">
                <span id="modal-tag" class="text-[10px] font-bold tracking-widest uppercase bg-red-600 px-2 py-1 rounded text-white mb-2 inline-block"></span>
                <h3 id="modal-title" class="text-2xl font-bold text-gray-900 mb-2 leading-tight"></h3>
                <div id="modal-hours" class="text-xs text-gray-500 mb-4 pb-3 border-b border-gray-100 flex items-center"><i class="far fa-clock mr-2 text-red-400"></i><span></span></div>
                <p id="modal-desc" class="text-gray-600 leading-relaxed text-sm mb-6 whitespace-pre-line"></p>
                
                <div id="modal-notes-container" class="hidden mb-6 bg-amber-50 p-4 rounded-xl border border-amber-100">
                    <h4 class="text-[10px] font-bold text-amber-600 uppercase mb-1"><i class="fas fa-pen-fancy mr-1"></i> é‡è¦è³‡è¨Š</h4>
                    <p id="modal-notes" class="text-xs text-amber-800 leading-relaxed mb-3"></p>
                    <div id="modal-link-btn" class="hidden">
                        <a id="modal-pdf-link" href="#" target="_blank" class="flex items-center justify-center gap-2 bg-amber-600 text-white py-2 rounded-lg text-xs font-bold shadow-sm">
                            <i class="fas fa-file-pdf"></i> æŸ¥çœ‹è¨‚å–®æ†‘è­‰ (PDF/é›²ç«¯)
                        </a>
                    </div>
                </div>

                <div id="modal-mapcode-btn" class="hidden bg-red-50 p-4 rounded-xl border border-red-100 flex items-center justify-between cursor-pointer mb-3">
                    <div class="flex items-center">
                        <div class="bg-red-500 p-2 rounded-lg text-white mr-3 shadow-sm"><i class="fas fa-map-marked-alt"></i></div>
                        <div><p class="text-[9px] text-red-500 font-bold uppercase">Copy MapCode</p><p id="modal-mapcode" class="text-base font-mono font-bold text-red-900"></p></div>
                    </div>
                    <i class="far fa-copy text-red-400"></i>
                </div>
                <a id="modal-google-link" href="#" target="_blank" class="w-full bg-gray-900 text-white py-4 rounded-xl flex items-center justify-center font-bold text-sm shadow-md">
                    <i class="fab fa-google mr-2 text-orange-400"></i> Google Maps å°èˆª
                </a>
            </div>
        </div>
    </div>

    <script>
        const startDate = new Date('2026-01-19T15:20:00');
        const members = ['CN', 'SW', 'William']; 
        const daysOfWeek = ['SUN', 'MON', 'TUE', 'WED', 'THU', 'FRI', 'SAT'];
        
        let currentDay = 1;
        let activeTab = 'itinerary';
        let expenses = JSON.parse(localStorage.getItem('okinawa_expenses') || '[]');
        let currentRate = parseFloat(localStorage.getItem('okinawa_jpy_rate') || '0.215');
        let checklistState = JSON.parse(localStorage.getItem('okinawa_checklist') || '{}');

        const tripData = {
             1: [
                { time: "15:20", tag: "Departure", title: "å°ç£æ¡ƒåœ’æ©Ÿå ´èµ·é£› (MM926)", icon: "fa-plane-departure", desc: "é–‹å•Ÿå—åœ‹æ²–ç¹©æ¥µè‡´ä¹‹æ—…ã€‚å»ºè­°æ—…å®¢æ–¼èµ·é£›å‰2å°æ™‚æŠµé”æ¡ƒåœ’åœ‹éš›æ©Ÿå ´è¾¦ç†ç™»æ©Ÿèˆ‡è¡Œæè¨—é‹ã€‚é£›è¡Œæ™‚é–“ç´„1.5å°æ™‚ï¼Œå¯æ–¼æ©Ÿä¸Šç¨ä½œä¼‘æ¯ï¼Œé å‚™è¿æ¥å……æ»¿ç‰çƒé¢¨æƒ…çš„å‡æœŸã€‚", img: "https://images.unsplash.com/photo-1436491865332-7a61a109cc05?q=80&w=1000", notes: "" },
                { time: "17:50", tag: "Arrival", title: "æŠµé”é‚£éœ¸æ©Ÿå ´ & æ­ä¹˜å–®è»Œ", icon: "fa-train-subway", desc: "æŠµé”é‚£éœ¸ç©ºæ¸¯ã€‚å®Œæˆå…¥å¢ƒæ‰‹çºŒå¾Œï¼Œè«‹è·Ÿéš¨æŒ‡æ¨™å‰å¾€åœ‹å…§ç·šèˆªå»ˆ2æ¨“éŠœæ¥å–®è»Œé›»è»Šï¼ˆYui Railï¼‰ã€‚é€™æ˜¯é«”é©—æ²–ç¹©éƒ½æœƒæ„Ÿçš„ç¬¬ä¸€æ­¥ï¼Œæ²¿é€”å¯åˆæ­¥è§€è¦½é‚£éœ¸å¸‚å€çš„ç¹è¯æ™¯è§€èˆ‡äºç†±å¸¶æ°›åœã€‚", img: "https://upload.wikimedia.org/wikipedia/commons/e/e0/Okinawa-Monorail_Series1000_Asahimachi.jpg", notes: "" },
                { time: "18:45", tag: "Hotel", title: "æ±æ©«INN é‚£éœ¸ Omoromachi ç«™å‰", icon: "fa-hotel", hours: "Check-in 15:00+", map: "æ±æ©«INN é‚£éœ¸ Omoromachi ç«™å‰", desc: "ç·Šé„°å–®è»Œæ­Œç”ºç«™ï¼Œåœ°ç†ä½ç½®å„ªè¶Šã€‚é£¯åº—æä¾›å…è²»æ—©é¤ï¼Œä¸”æ­£å°é¢å³æ˜¯ DFS ç§Ÿè»Šé»ï¼Œæ˜¯è‡ªé§•è¡Œç¨‹çš„æœ€ä½³åŸºåœ°ã€‚å‘¨é‚Šæœ‰æ–°éƒ½å¿ƒå•†åœˆã€å¤§åœ‹è—¥å¦èˆ‡è¶…å¸‚ï¼Œç”Ÿæ´»æ©Ÿèƒ½å¼·å¤§ã€‚", img: "https://image.kkday.com/v2/image/get/w_1900%2Cc_fit/s1.kkday.com/product_152772/20230923055533_i6bm4/jpg", notes: "è¨‚å–®ç·¨è™Ÿ: 5422314614\nåœ°å€ï¼šé‚£éœ¸å¸‚æ­Œç”º1-6-6\né›»è©±ï¼š+81-98-862-1045\nhttps://drive.google.com/file/d/1x6wEhdO34cDj6wGcgBg95QDzNLPSyOwA/view?usp=sharing" },
                { 
                    time: "19:30", tag: "Night", title: "åœ‹éš›é€š æ•£ç­–", icon: "fa-person-walking", map: "åœ‹éš›é€š", hours: "10:00-22:00", desc: "è­½ç‚ºã€Œå¥‡è¹Ÿçš„ä¸€å“©è·¯ã€çš„é‚£éœ¸ç¬¬ä¸€è¡—ã€‚é€™æ¢å…¨é•·1.6å…¬é‡Œçš„è¡—é“åœ¨æˆ°å¾Œè¿…é€Ÿå¾©ç”¦ï¼Œç¾å·²æˆç‚ºæ²–ç¹©æœ€ç¹è¯çš„å•†æ¥­æ ¸å¿ƒã€‚è¡—é“å…©å´é›†çµäº†è±å¯Œçš„åœŸç”¢åº—ã€æ½®æµæœé£¾ã€è—¥å¦æ——è‰¦åº—èˆ‡å„å¼ä¸»é¡Œé¤å»³ï¼Œæ˜¯é«”é©—æ²–ç¹©ç†±æƒ…å¤œæ™šã€å°‹å¯¶æƒè²¨èˆ‡æ„Ÿå—å—åœ‹æ´»åŠ›çš„å¿…è¨ªå‹åœ°ã€‚", img: "https://images.unsplash.com/photo-1647336963732-7446b9da7a6f?q=80&w=1170&auto=format&fit=crop",
                    subs: [
                        { type: "æ™šé¤", name: "åœ‹éš›é€šå±‹å°æ‘", hours: "11:00-23:00", mapcode: "33 157 444*55", map: "åœ‹éš›é€šå±‹å°æ‘", desc: "ç”±20é–“ç‰¹è‰²å°åº—çµ„æˆçš„å±…é…’å±‹è¡—ã€‚æä¾›é“åœ°æ³¡ç››èˆ‡å‰µæ„æ–™ç†ï¼Œæ˜¯é«”é©—åœ¨åœ°ç”Ÿæ´»æ„Ÿèˆ‡ç¤¾äº¤æ°›åœçš„æœ€ä½³å ´æ‰€ã€‚", img: "https://static.gltjp.com/glt/data/directory/14000/13966/20221104_110633_5122610b_w1920.webp" },
                        { type: "æ™šé¤", name: "ç‰çƒçš„ç‰›", hours: "17:00-22:30", mapcode: "33 157 448*38", map: "ç‰çƒçš„ç‰›", desc: "æ²–ç¹©é«˜äººæ°£é ‚ç´šç‡’è‚‰ï¼Œåš´é¸ç¸£ç”¢å’Œç‰›èˆ‡å¤šæ¨£åŒ–ç²¾ç·»å¥—é¤ã€‚å¼·çƒˆå»ºè­°æå‰é ç´„ã€‚", img: "https://www.u-shi.net/img/shopinfo/naha2.jpg" },
                        { type: "ç”œé»", name: "Blue Seal å†°æ·‡æ·‹", hours: "10:00-22:00", map: "Blue Seal åœ‹éš›é€š", desc: "æ²–ç¹©ä»£è¡¨æ€§å†°æ·‡æ·‹ï¼Œæ¨è–¦ç´…èŠ‹èˆ‡é›ªé¹½å‘³ã€‚", img: "https://sydney-blog.com/wp-content/uploads/2024/06/s__64839791-197690351-e1718103592320.jpg?w=1400" },
                        { type: "ç”œé»", name: "KOI ThÃ© é£²æ–™åº—", hours: "10:00-21:00", map: "KOI ThÃ© åœ‹éš›é€š", desc: "äººæ°£æ‰‹æ–èŒ¶é£²ï¼Œæ‹›ç‰Œé»ƒé‡‘çç å¥¶èŒ¶ã€‚", img: "https://i0.wp.com/carollin.tw/wp-content/uploads/20170418013350_6.jpg?ssl=1" }
                    ]
                }
            ],
            2: [
                { time: "09:00", tag: "Rental", title: "ç§Ÿè»Šå–è»Š (DFS T Galleria)", icon: "fa-car", map: "DFS T Galleria", mapcode: "33 188 295*36", desc: "æ­¥è¡Œéé¦¬è·¯å³å¯æŠµé” DFS æ«ƒå°è¾¦ç†å–è»Šã€‚é£¯åº—å°±åœ¨å°é¢ï¼Œçœå»äº¤é€šè² æ“”ï¼Œè¼•é¬†é–‹å•ŸåŒ—ä¸Šè‡ªé§•ä¹‹æ—…ã€‚", img: "https://www.otsinternational.jp/otsrentacar/img/upload/car_office/4_dfs_1.png" },
                { 
                    time: "10:30", tag: "Island", title: "å¤å®‡åˆ©å¤§æ©‹ & å¤å®‡åˆ©å³¶", icon: "fa-bridge", map: "å¤å®‡åˆ©å¤§æ©‹", mapcode: "485 662 041*33", desc: "å¤å®‡åˆ©å¤§æ©‹æ˜¯ä¸€åº§å…¨é•· 1,960å…¬å°º çš„è·¨æµ·å¤§æ©‹ï¼Œé€£æ¥æ²–ç¹©æœ¬å³¶ï¼ˆåè­·å¸‚å±‹æˆ‘åœ°å³¶ï¼‰èˆ‡ã€Œç¥ä¹‹å³¶ã€å¤å®‡åˆ©å³¶ã€‚ä»¥å…¶å…©å´ä¸€æœ›ç„¡éš›çš„ç¿¡ç¿ ç¶ æµ·æ´‹æ™¯è§€è€Œèåï¼Œæ˜¯æ²–ç¹©æ¥µå—æ­¡è¿çš„è‡ªé§•å…œé¢¨è·¯ç·šã€‚å¤å®‡åˆ©å³¶æœ¬èº«ç”±çŠç‘šç¤å½¢æˆï¼Œå³¶ä¸Šæœ‰è¨±å¤šå€¼å¾—æ¢ç´¢çš„æ™¯é»ã€‚\n\nå¤å®‡åˆ©æµ·ç˜: ä½æ–¼å¤å®‡åˆ©äº¤æµå»£å ´æ—ï¼Œæœ‰è‘—ç¾éº—çš„æ²™ç˜å’Œå®Œå–„çš„è¨­æ–½ï¼Œæä¾›æ°´ä¸Šæ´»å‹•ã€‚\nå¤å®‡åˆ©æµ·æ´‹å¡”: ä½æ–¼å³¶ä¸Šé«˜è™•ï¼Œå¯ä»¥æ­ä¹˜è‡ªå‹•é§•é§›çš„é«˜çˆ¾å¤«çƒè»Šå‰å¾€å¡”é ‚ï¼Œä¿¯ç°å…¨å³¶åŠå¤å®‡åˆ©å¤§æ©‹çš„å£¯éº—æ™¯è‰²ã€‚", img: "https://cdn.zekkei-japan.jp/images/articles/488e523c67776b1cf867452f7dc6008a.jpg",
                    subs: [{ type: "åˆé¤", name: "å¤å®‡åˆ©è¦è¦é£¯", hours: "11:00-18:00", mapcode: "485 692 174*01", map: "Kouri Shrimp", desc: "è’œé¦™å¥¶æ²¹é¢¨å‘³åè¶³ã€‚åœ¨æµ·é‚Šè²¨æ«ƒå±‹å“åšé€™ä»½è¶…äººæ°£é®®è¦ç››å®´ã€‚", img: "https://cc.tvbs.com.tw/img/program/upload/2023/06/30/20230630153541-410273ba.jpg" }]
                },
                { 
                    time: "13:30", tag: "Ocean", title: "ç¾éº—æµ·æ°´æ—é¤¨", icon: "fa-fish", map: "ç¾éº—æµ·æ°´æ—é¤¨", mapcode: "553 075 797*77", hours: "08:30-18:30", desc: "æ²–ç¹©ç¾éº—æµ·æ°´æ—é¤¨ï¼ˆChuraumi Aquariumï¼‰æ˜¯æµ·æ´‹åšå…¬åœ’å…§çš„äººæ°£æ™¯é»ï¼Œä»¥ã€Œç¾éº—çš„æµ·æ´‹ã€ç‚ºä¸»é¡Œï¼Œå±•ç¤ºæ²–ç¹©è±å¯Œå¤šæ¨£çš„æµ·æ´‹ç”Ÿæ…‹ï¼Œå…¶ç‰¹è‰²æ˜¯å·¨å¤§çš„ã€Œé»‘æ½®ä¹‹æµ·ã€æ°´æ§½ï¼Œé£¼é¤Šè‘—ä¸–ç•Œæœ€å¤§é­šé¡é¯¨é¯Šèˆ‡é¬¼è é­Ÿï¼Œä¸¦æœ‰é™½å…‰ç‘è½çš„ã€ŒçŠç‘šä¹‹æµ·ã€å’Œç¥ç¥•çš„ã€Œæ·±æµ·ä¹‹æ—…ã€å€åŸŸï¼Œé‚„æœ‰å…è²»æµ·è±šç§€ã€æµ·é¾œé¤¨ç­‰å‘¨é‚Šè¨­æ–½ï¼Œæ˜¯é«”é©—æ²–ç¹©æµ·æ´‹é­…åŠ›çš„å¿…è¨ªä¹‹åœ°ã€‚", img: "https://images.unsplash.com/photo-1612476919598-a233d3692cc6?q=80&w=1170&auto=format&fit=crop",
                    subs: [
                        { type: "è¡¨æ¼”", name: "æµ·è±šç§€: 15:00 / 17:00", hours: "ç´„20åˆ†é˜", map: "æµ·è±šåŠ‡å ´", desc: "æˆ¶å¤–åŠ‡å ´çš„äººæ°£è¡¨æ¼”ï¼Œæµ·è±šå€‘ç²¾æ¹›çš„æ¼”å‡ºèˆ‡æ¹›è—å¤§æµ·ç‚ºæ™¯ã€‚", img: "https://churaumi.okinawa/userfiles/images/area/surrounding/DSC02344.jpg" },
                        { type: "è¡¨æ¼”", name: "é¯¨é¯Šé¤µé£Ÿç§€: 15:00 / 17:00", hours: "é»‘æ½®ä¹‹æµ·æ§½å‰", map: "ç¾éº—æµ·æ°´æ—é¤¨", desc: "å·¨å‹é¯¨é¯Šåœ¨æ°´ä¸­å‚ç›´é€²é£Ÿçš„éœ‡æ’¼ç¬é–“ã€‚", img: "https://assets.funliday.com/posts/wp-content/uploads/2023/03/05233404/IMG_8454-scaled.jpg" }
                    ]
                },
                { 
                    time: "18:30", tag: "Dinner", title: "ç¾åœ‹æ‘ æ•£ç­–", icon: "fa-ferris-wheel", map: "ç¾åœ‹æ‘", mapcode: "33 526 450*63", desc: "æ²–ç¹©ç¾åœ‹æ‘ï¼ˆMihama American Villageï¼‰ä½æ–¼åŒ—è°·ç”ºï¼Œæ˜¯èåˆç¾å¼é¢¨æƒ…èˆ‡æ²–ç¹©ç‰¹è‰²çš„ç¶œåˆæ€§å¨›æ¨‚è³¼ç‰©å€ï¼Œç”±ç¾è»åŸºåœ°æ­¸é‚„åœŸåœ°é–‹ç™¼è€Œæˆï¼Œå……æ»¿è‰²å½©ç¹½ç´›çš„ç¾å¼å»ºç¯‰ã€è¡—é ­è—è¡“èˆ‡ç•°åœ‹æ°›åœã€‚é€™è£¡é›†çµäº†ç´„350é–“å•†åº—ã€é¤å»³ã€é›»å½±é™¢ã€éŠæ¨‚å ´ï¼Œæä¾›ç¾å¼èˆ‡æ²–ç¹©ç‰¹è‰²ç¾é£Ÿã€‚\n\nDepot Islandï¼šç´…ç£šé“ã€ç•°åœ‹é¢¨å»ºç¯‰ï¼Œå……æ»¿æ™‚å°šæ„Ÿï¼Œæ˜¯æ‹ç…§ç†±é»ã€‚\nAmerica Depotï¼šç¾å¼å¾©å¤é¢¨æ ¼ï¼Œæœ‰è¨±å¤šç‰¹è‰²åº—èˆ–å’ŒéŠæˆ²ä¸­å¿ƒã€‚", img: "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiTiTfQo0lBlgTRpdltj6PVc5eW9G2C3yEnjJ1xGmWk4jOKmDTNTzZ2R_xqaPAyYjX5dMRSuV9NebKGmZ4-Mq_FJDrI3B2ET5Ayha8cSG77fo5rc-U4Nydp1NdGhsFkXBX0ZOXpsFZiu7I9jdCAv2FBpriMbWQHpuZ7PTNvKkc1rU7okfqbvRItGQvUmVjA/s1600-rw/Okinawa-American-Village-3.jpg",
                    subs: [
                        { type: "æ™šé¤", name: "ã‚°ãƒ«ãƒ¡å›è»¢ sushi å¸‚å ´", hours: "11:30-21:00", mapcode: "33 526 459*11", map: "ã‚°ãƒ«ãƒ¡å›è»¢å¸‚å ´", desc: "åŒ—è°·è¶…äººæ°£è¿´è½‰å£½å¸ï¼Œé£Ÿææ¼æ¸¯ç›´é€ï¼ŒCPå€¼æ¥µé«˜ã€‚", img: "https://img.poibank.com/SaGXj-6gjSM1TuYYdXJzs8NU7Kg=/W3siZm9ybWF0IjoianBnIn0seyJrZXkiOiJzdWdnZXN0aW9uLzI2NDM3NDQyLzEwNTAxNjI3LzE2OTE4NTY0NDI4MDIifSx7InJlc2l6ZSI6eyJ3aWR0aCI6IjE0NzcifX1d" },
                        { type: "æ™šé¤", name: "A&W æ¼¢å ¡", hours: "09:00-22:00", map: "A&W ç¾åœ‹æ‘", desc: "æ²–ç¹©é™å®šç¾å¼é€Ÿé£Ÿï¼Œå¿…é»æ²™å£«é…æ²æ²è–¯æ¢ã€‚", img: "https://pimg.1px.tw/muzuochen/1448980489-647390745.jpg" }
                    ]
                }
            ],
            3: [
                { time: "09:30", tag: "Heritage", title: "é¦–é‡ŒåŸ", icon: "fa-landmark", map: "é¦–é‡ŒåŸ", mapcode: "33 161 526*66", hours: "08:30-18:00", desc: "é¦–é‡ŒåŸæ˜¯ä½æ–¼æ²–ç¹©é‚£éœ¸å¸‚ã€ç‰çƒç‹åœ‹çš„éƒ½åŸèˆ‡ç‹å®®ï¼Œå…¼æ”¿æ²»ã€å¤–äº¤ã€ç¶“æ¿Ÿä¸­å¿ƒï¼ŒåŒæ™‚ä¹Ÿæ˜¯ä¸­å¤®è¡Œæ”¿æ©Ÿé—œå’Œèˆ‰è¡Œç¥­ç¥€å„€å¼çš„æ‰€åœ¨åœ°ï¼Œè¦‹è­‰äº†ç‰çƒåœ‹é•·é”500å¹´çš„æ­·å²èˆ‡ç¨ç‰¹æ–‡åŒ–ã€‚é›–åœ¨1945å¹´å’Œ2019å¹´å¤§ç«ä¸­å—æï¼Œä½†æ­£é€²è¡Œé‡å»ºï¼Œé è¨ˆ2026å¹´ä¿®å¾©å®Œæˆã€‚", img: "https://ohh.okinawa/wpdir/wp-content/uploads/2018/10/7ac047596507fadd22e23647ff3ae1d4.jpg" },
                { 
                    time: "11:30", tag: "Cave", title: "ç‰æ³‰æ´ / æ²–ç¹©ä¸–ç•Œ", icon: "fa-mountain-sun", map: "ç‰æ³‰æ´", mapcode: "232 495 330*28", hours: "09:00-17:30", desc: "ç‰æ³‰æ´æ˜¯æ—¥æœ¬æ²–ç¹©ä¸–ç•Œæ–‡åŒ–ç‹åœ‹çš„ä¸»é«”æ™¯é»ï¼Œæ˜¯ä¸€å€‹æ­·ç¶“30è¬å¹´å½¢æˆçš„æ—¥æœ¬ç¬¬äºŒå¤§é˜ä¹³æ´ï¼Œæ“æœ‰è¶…éç™¾è¬æ ¹é˜ä¹³çŸ³èˆ‡ç¥ç§˜åœ°ä¸‹æ°´æ™¯è§€ï¼Œå…¨é•·5000å…¬å°ºï¼ŒéŠå®¢å¯æ¼«æ­¥æ–¼å°å¤–é–‹æ”¾çš„ç´„890å…¬å°ºæ­¥é“ï¼Œæ¬£è³ã€Œé’ä¹‹æ³‰ã€ç­‰å¥‡æ™¯ã€‚", img: "https://images.unsplash.com/photo-1550992402-9b1fc58fd76d?q=80&w=1170&auto=format&fit=crop",
                    subs: [
                        { type: "è¡¨æ¼”", name: "12:30 å¤ªé¼“è¡¨æ¼”", hours: "ç´„30åˆ†é˜", map: "è¡¨æ¼”å»£å ´", desc: "éœ‡æ’¼éˆé­‚çš„å‚³çµ±èˆè¹ˆã€‚", img: "https://www.okitour.co.jp/uploads/contents/product/Ifz2McHD8" },
                        { type: "åˆé¤", name: "å±‹å®œå®¶ (è€å±‹æ²–ç¹©éºµ)", hours: "11:00-15:30", mapcode: "232 465 718*33", map: "å±‹å®œå®¶", desc: "åœ¨è¢«ç™»éŒ„ç‚ºåœ‹å®¶æœ‰å½¢æ–‡åŒ–è²¡çš„ç™¾å¹´è€å®…ä¸­äº«ç”¨ç¾é£Ÿã€‚", img: "https://okinawa-daily.com/wp-content/uploads/2021/02/46E0F9C9-83D4-4E52-9EB9-27F4960E2CD4.jpeg" }
                    ]
                },
                { 
                    time: "14:30", tag: "View", title: "ç€¨é•·å³¶", icon: "fa-plane-up", map: "ç€¨é•·å³¶", mapcode: "33 002 602*06", desc: "ç€¨é•·å³¶æ˜¯æ²–ç¹©é‚£éœ¸æ©Ÿå ´é™„è¿‘ä¸€å€‹è¿·ä½ å°å³¶ï¼Œå› æœ‰è·¨æµ·å¤§æ©‹èˆ‡æœ¬å³¶ç›¸é€£ï¼Œäº¤é€šæ¥µç‚ºä¾¿åˆ©ï¼Œä»¥ç´”ç™½åœ°ä¸­æµ·é¢¨æ ¼å»ºç¯‰ç¾¤ã€Œæµ·é¢¨éœ²å°(Umikaji Terrace)ã€èåï¼Œèƒ½è¿‘è·é›¢è§€è³é£›æ©Ÿèµ·é™ï¼Œæ˜¯ç†±é–€çš„æ‰“å¡é»èˆ‡åŠæ—¥éŠé¦–é¸ã€‚", img: "https://visitokinawajapan.com/wp-content/themes/visit-okinawa_multi-language/lang/zh-hant/assets/img/destinations/okinawa-main-island/southern-okinawa-main-island/senaga-island/de36_kv_senaga-island-umikaji-terrace.webp",
                    subs: [{ type: "ç”œé»", name: "å¹¸ç¦é¬†é¤…", hours: "11:00-19:00", map: "å¹¸ç¦é¬†é¤… ç€¨é•·å³¶", desc: "é¬†è»Ÿç¶¿å¯†çš„äººæ°£èˆ’èŠ™è•¾ã€‚", img: "https://dina.tw/wp-content/uploads/2024/04/10%E5%B9%B8%E7%A6%8F%E9%AC%86%E9%A4%85.jpg" }]
                },
                { time: "16:00", tag: "Shrine", title: "æ³¢ä¸Šå®® & æ³¢ä¹‹ä¸Šæµ·ç˜", icon: "fa-torii-gate", map: "æ³¢ä¸Šå®®", mapcode: "33 185 022*00", hours: "09:00-17:00", desc: "æ³¢ä¸Šå®®æ˜¯æ²–ç¹©é‚£éœ¸å¸‚å»ºç«‹åœ¨çŠç‘šç¤æ‡¸å´–ä¸Šçš„å¤è€ç¥ç¤¾ï¼Œæ˜¯ç‰çƒå…«ç¤¾ä¹‹é¦–ï¼Œä¾›å¥‰èˆªæµ·ã€æ¼æ¥­èˆ‡äº”ç©€è±æ”¶ä¹‹ç¥ã€‚ç¥ç¤¾ä¸‹æ–¹çš„æ³¢ä¹‹ä¸Šæµ·ç˜æ˜¯å¸‚å…§å”¯ä¸€çš„å¤©ç„¶æ²™ç˜ã€‚", img: "https://s3-ap-northeast-1.amazonaws.com/thegate/2021/02/09/18/08/05/namino_ue_gu_shrine.jpg" },
                { time: "18:30", tag: "Task", title: "ç§Ÿè»Šé‚„è»Š (DFS)", icon: "fa-gas-pump", map: "DFS T Galleria", desc: "å®Œæˆç²¾å½©è‡ªé§•ä»»å‹™ã€‚é‚„è»Šé»å°±åœ¨é£¯åº—å°é¢ã€‚", img: "https://www.otsinternational.jp/otsrentacar/img/upload/car_office/4_dfs_1.png", notes: "é‚„è»Šå‰è«‹è‡³é„°è¿‘åŠ æ²¹ç«™å°‡æ²¹ç®±åŠ æ»¿ã€‚" },
                { 
                    time: "19:00", tag: "Shopping", title: "æ–°éƒ½å¿ƒå•†åœˆ (Omoromachi)", icon: "fa-bag-shopping", map: "æ–°éƒ½å¿ƒ", desc: "æ²–ç¹©ã€Œæ–°éƒ½å¿ƒã€æ˜¯é‚£éœ¸å¸‚å€ä¸€å€‹ç¾ä»£åŒ–çš„è³¼ç‰©èˆ‡ç”Ÿæ´»ä¸­å¿ƒï¼Œé›†çµäº†å…ç¨…ç²¾å“ã€æ—¥ç³»æœé£¾UQGUã€å®¶é›»ã€é›œè²¨ã€è¶…å¸‚ã€ç¾é£Ÿé¤å»³å’Œé›»å½±é™¢ã€‚", img: "https://www.tabirai.net/tabirai-uploader/img/0016739/s1_0016739.jpg",
                    subs: [{ type: "æ™šé¤", name: "ç›®åˆ©éŠ€æ¬¡", hours: "17:00-01:00", mapcode: "33 188 659*45", map: "ç›®åˆ©éŠ€æ¬¡ æ–°éƒ½å¿ƒ", desc: "æµ®èª‡æœ¨æ¡¶è£æ½¢èˆ‡é ‚ç´šé®®é­šæ–™ç†ã€‚", img: "https://mimigo.tw/wp-content/uploads/20190328181052_47.jpg", notes: "" }]
                }
            ],
            4: [
                { time: "10:00", tag: "Stay", title: "é£¯åº— Checkout & å¯„æ”¾è¡Œæ", icon: "fa-suitcase", hours: "10:00 æˆªæ­¢", desc: "è«‹æ–¼10:00å‰å®Œæˆé€€æˆ¿ã€‚å› é£¯åº—å°±åœ¨å–®è»Œç«™æ—ï¼Œå¼·çƒˆå»ºè­°ç›´æ¥å°‡è¡Œæå¯„æ”¾åœ¨é£¯åº—æ«ƒæª¯ï¼Œå¾…ä¸‹åˆè¡Œç¨‹çµæŸå¾Œå†å›ä¾†é ˜å–æ­é›»è»Šå‰å¾€æ©Ÿå ´ã€‚", img: "https://image.kkday.com/v2/image/get/w_1900%2Cc_fit/s1.kkday.com/product_152772/20230923055533_i6bm4/jpg", notes: "ã€è¡Œæè™•ç†å»ºè­°ã€‘\n1. æ±æ©«INN æ«ƒæª¯å¯„æ”¾ (å…è²»ä¸”æœ€å®‰å…¨ç©©å®š)ã€‚\n2. å‚™æ¡ˆï¼šæ­Œç”ºç«™ç½®ç‰©æ«ƒ (è‹¥æ«ƒæª¯æœ‰ç‰¹æ®Šè¦å®šæ™‚ä½¿ç”¨)ã€‚" },
                { 
                    time: "10:30", tag: "Market", title: "å¹³å’Œé€š & ç¬¬ä¸€ç‰§å¿—å¸‚å ´", icon: "fa-store", map: "ç‰§å¿—å¸‚å ´", mapcode: "33 157 323*52", hours: "08:00-21:00", desc: "ç¬¬ä¸€ç‰§å¿—å…¬è¨­å¸‚å ´æ˜¯é‚£éœ¸åœ‹éš›é€šæ—ä¸€å€‹æ­·å²æ‚ ä¹…ã€å……æ»¿æ´»åŠ›çš„å‚³çµ±å¸‚å ´ï¼Œè¢«è­½ç‚ºã€Œæ²–ç¹©äººçš„å»šæˆ¿ã€ï¼Œæ–¼2023å¹´æ•´ä¿®ç¿»æ–°å¾Œï¼Œæä¾›æ›´èˆ’é©çš„ç’°å¢ƒï¼Œå¯é«”é©—ã€Œç¾è²·ç¾æ–™ç†ã€çš„ç¨ç‰¹æ²–ç¹©ç¾é£Ÿæ–‡åŒ–ã€‚", img: "https://guide-book-pic.s3.ap-southeast-2.amazonaws.com/makishi.jpeg",
                    subs: [
                        { type: "ç”œé»", name: "é¹½å±‹ (é›ªé¹½å†°æ·‡æ·‹)", hours: "10:00-20:00", map: "é¹½å±‹", desc: "é¹¹ç”œäº¤ç¹”çš„å¤šå±¤æ¬¡é©šå–œæ»‹å‘³ã€‚", img: "https://bobbyfun.tw/wp-content/uploads/pixnet/8c114902489725d46a5d931b46e1a903.jpg" },
                        { type: "åˆé¤", name: "æµ·é®®å¤§é¤ (ä»£å®¢æ–™ç†)", hours: "11:00-19:00", map: "ç¬¬ä¸€ç‰§å¿—å¸‚å ´", desc: "ç¾é»ç¾åšï¼Œæ¥µè‡´é®®ç¾äº«å—ã€‚", img: "https://i1.wp.com/itravelblog.net/wp-content/uploads/2024/05/First-Makishi-Public-Market-16.jpg" }
                    ]
                },
                { time: "14:00", tag: "Transit", title: "å›é£¯åº—å–è¡Œæ & å‰å¾€æ©Ÿå ´", icon: "fa-train", map: "é‚£éœ¸æ©Ÿå ´", desc: "æ­å–®è»Œé›»è»Šå‰å¾€æ©Ÿå ´ã€‚", img: "https://static.gltjp.com/glt/data/directory/18000/17994/20251008_082552_97874209_w1920.webp" },
                { time: "16:50", tag: "Bye", title: "é‚£éœ¸æ©Ÿå ´èµ·é£› (MM929)", icon: "fa-plane-departure", desc: "å¸¶è‘—æ»¿è¼‰å›æ†¶èˆ‡æˆ°åˆ©å“å›åœ‹ã€‚", img: "https://images.unsplash.com/photo-1436491865332-7a61a109cc05?q=80&w=1000" }
            ]
        };

        const packingList = [
            { cat: "éš¨èº«è¡Œæ", items: ["è­·ç…§ (æ•ˆæœŸ6å€‹æœˆä»¥ä¸Š)", "éŒ¢å ± (å¤–å¹£)/ä¿¡ç”¨å¡", "äº¤é€šå¡ Suica/ICOCA (iPhone)", "é§•ç…§æ­£æœ¬+æ—¥æ–‡è­¯æœ¬", "æ©Ÿç¥¨/è¨‚æˆ¿/ç§Ÿè»Šæ†‘è­‰", "è¡Œå‹•é›»æº", "æ—¥æœ¬ç¶²å¡/eSIM", "å€‹äººè—¥å“", "å¤–å¥—/åœå·¾/å¸½å­", "ç›¸æ©Ÿ/è…³æ¶", "éš¨èº«é¢ç´™/å¤¾éˆè¢‹"] },
            { cat: "è¨—é‹è¡Œæ", items: ["å……é›»å™¨/è½‰æ¥é ­", "åˆ®é¬åˆ€", "ç‰™åˆ·/ç‰™è†", "æ›æ´—è¡£ç‰© (3-4å¥—)", "å…§è¡£è¤²/è¥ªå­", "ç¡è¡£", "æ‘ºç–Šå‚˜", "ç’°ä¿è³¼ç‰©è¢‹", "é«’è¡£æ”¶ç´è¢‹", "è»Šå……è½‰æ¥é ­"] }
        ];

        const phrases = [
            { j: "ãŠä¼šè¨ˆã‚’ãŠé¡˜ã„ã—ã¾ã™", r: "O-kaikei o negai shimasu", e: "æˆ‘è¦çµå¸³" },
            { j: "ãƒˆã‚¤ãƒ¬ã¯ã©ã“ã§ã™ã‹ï¼Ÿ", r: "Toire wa doko desu ka?", e: "å»æ‰€åœ¨å“ªï¼Ÿ" },
            { j: "ã“ã‚Œã‚’ãã ã•ã„", r: "Kore o kudasai", e: "è«‹çµ¦æˆ‘é€™å€‹ (æŒ‡åœ–)" },
            { j: "é ˜åæ›¸ã‚’ãã ã•ã„", r: "Ryoushuusho o kudasai", e: "è«‹çµ¦æˆ‘æ”¶æ“š (é‚„è»ŠåŠ æ²¹ç”¨)" }
        ];

        // --- æ ¸å¿ƒé‚è¼¯ ---

        async function fetchWeather() {
            try {
                const res = await fetch("https://api.open-meteo.com/v1/forecast?latitude=26.2124&longitude=127.6809&daily=weathercode,temperature_2m_max,temperature_2m_min&timezone=Asia%2FTokyo");
                const data = await res.json();
                for (let i = 0; i < 2; i++) {
                    const code = data.daily.weathercode[i];
                    const max = Math.round(data.daily.temperature_2m_max[i]);
                    const min = Math.round(data.daily.temperature_2m_min[i]);
                    document.getElementById(`w-temp-${i}`).textContent = `${min}Â°/${max}Â°`;
                    document.getElementById(`w-icon-${i}`).className = "fas " + getWeatherIcon(code);
                }
            } catch (e) { console.error("Weather Error", e); }
        }

        function getWeatherIcon(code) {
            if (code <= 1) return "fa-sun text-orange-400";
            if (code <= 3) return "fa-cloud-sun text-yellow-500";
            if (code <= 65) return "fa-cloud-showers-heavy text-blue-400";
            return "fa-cloud text-gray-400";
        }

        function updateCountdown() {
            const diff = startDate - new Date();
            const el = document.getElementById('countdown');
            if (diff < 0) { el.textContent = "Journey in Progress ğŸŒ´"; return; }
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hrs = Math.floor((diff / (1000 * 60 * 60)) % 24);
            el.textContent = `Countdown: ${days}D ${hrs}H to Okinawa`;
        }

        function initApp() {
            activeTab = 'itinerary';
            renderDatePicker();
            renderItinerary();
            fetchWeather();
            updateCountdown();
            setInterval(updateCountdown, 60000);
        }

        function renderDatePicker() {
            const picker = document.getElementById('date-picker-container');
            if (!picker) return;
            picker.innerHTML = '';
            for (let i = 0; i < 4; i++) {
                const date = new Date(startDate);
                date.setDate(startDate.getDate() + i);
                const dayNum = i + 1;
                const div = document.createElement('div');
                div.className = `flex flex-col items-center cursor-pointer transition-all ${dayNum === currentDay && activeTab === 'itinerary' ? 'active-date' : 'text-gray-300'}`;
                div.onclick = () => { 
                    activeTab = 'itinerary';
                    currentDay = dayNum; 
                    updateTabStyles();
                    renderDatePicker(); 
                    renderItinerary();
                };
                div.innerHTML = `<span class="text-[7px] font-bold text-gray-400 mb-0.5 uppercase tracking-tighter">JAN</span><span class="text-[8px] font-bold mb-0.5">${daysOfWeek[date.getDay()]}</span><span class="text-lg date-num font-serif leading-none">${date.getDate()}</span><div class="h-1 w-1 rounded-full date-dot mt-1"></div>`;
                picker.appendChild(div);
            }
        }

        function renderItinerary() {
            const container = document.getElementById('content');
            if (!container) return;
            container.innerHTML = '';
            let html = '<div class="timeline-wrapper"><div class="timeline-line"></div>';
            tripData[currentDay].forEach(item => {
                let subsHtml = '';
                if (item.subs) {
                    item.subs.forEach(sub => {
                        const subStr = encodeURIComponent(JSON.stringify({...sub, tag: sub.type, title: sub.name}));
                        subsHtml += `<div class="sub-card" onclick="event.stopPropagation(); showModal('${subStr}')"><div class="flex justify-between mb-1"><span class="text-[9px] font-bold text-red-500 uppercase">${sub.type}</span></div><div class="text-sm font-bold text-gray-700">${sub.name}</div></div>`;
                    });
                }
                html += `<div class="relative mb-10 pl-10"><div class="timeline-dot"></div><div class="flex items-baseline mb-2"><span class="text-xl font-serif font-bold text-gray-800 mr-3">${item.time}</span><div class="h-[1px] flex-1 bg-orange-50"></div></div><div class="bg-white p-4 rounded-xl shadow-sm border border-orange-50 active:scale-95 transition-all" onclick="showModal('${encodeURIComponent(JSON.stringify(item))}')"><div class="flex items-center justify-between mb-1.5"><div class="flex items-center"><i class="fas ${item.icon} mr-2 text-red-400 text-xs"></i><span class="text-[9px] font-bold text-red-400 uppercase tracking-widest">${item.tag}</span></div></div><h3 class="text-base font-bold text-gray-800 leading-tight">${item.title}</h3><p class="text-[11px] text-gray-400 mt-2 line-clamp-1 leading-relaxed">${item.desc}</p></div><div class="space-y-1">${subsHtml}</div></div>`;
            });
            container.innerHTML = html + '</div>';
        }

        function toggleView(view) {
            activeTab = view;
            updateTabStyles();
            renderDatePicker();
            if (view === 'ledger') renderLedger();
            else if (view === 'checklist') renderChecklist();
        }

        function updateTabStyles() {
            const lt = document.getElementById('ledger-toggle');
            const ct = document.getElementById('checklist-toggle');
            lt.className = `flex flex-col items-center pb-0.5 transition-all ${activeTab === 'ledger' ? 'nav-btn-active' : 'text-gray-300'}`;
            ct.className = `flex flex-col items-center pb-0.5 transition-all ${activeTab === 'checklist' ? 'nav-btn-active' : 'text-gray-300'}`;
        }

        function renderChecklist() {
            const container = document.getElementById('content');
            let html = `<div class="space-y-6">`;
            packingList.forEach(group => {
                html += `<div class="bg-white p-5 rounded-2xl shadow-sm border border-orange-100"><h3 class="text-sm font-bold text-red-500 mb-4 flex items-center"><i class="fas fa-check-circle mr-2"></i> ${group.cat}</h3><div class="space-y-3">`;
                group.items.forEach(item => {
                    const isChecked = checklistState[item] ? 'checked' : '';
                    html += `<label class="flex items-center justify-between p-3 bg-gray-50 rounded-xl"><span class="text-sm font-medium text-gray-700">${item}</span><input type="checkbox" onchange="toggleCheckItem('${item}')" ${isChecked} class="w-5 h-5 accent-red-500"></label>`;
                });
                html += `</div></div>`;
            });
            html += `<div class="bg-gray-800 p-5 rounded-2xl shadow-lg text-white"><h3 class="text-sm font-bold mb-4 flex items-center text-orange-400"><i class="fas fa-language mr-2"></i> å°ç™½æ±‚æ•‘å°è©±å¡</h3><div class="space-y-4">`;
            phrases.forEach(p => { html += `<div class="border-b border-gray-700 pb-2"><p class="text-xs text-gray-400 mb-1">${p.e}</p><p class="text-lg font-bold">${p.j}</p><p class="text-[10px] italic text-orange-300 opacity-70">${p.r}</p></div>`; });
            container.innerHTML = html + `</div></div></div>`;
        }

        function toggleCheckItem(item) { checklistState[item] = !checklistState[item]; localStorage.setItem('okinawa_checklist', JSON.stringify(checklistState)); }

        function renderLedger() {
            const container = document.getElementById('content');
            const todayStr = new Date().toISOString().split('T')[0];
            let balanceHtml = calculateBalances();
            container.innerHTML = `
                <div class="space-y-6">
                    <div class="bg-white p-5 rounded-2xl border border-orange-100 shadow-sm">
                        <h3 class="text-lg font-bold mb-4 text-gray-800 flex items-center"><i class="fas fa-plus-circle mr-2 text-red-400"></i> æ–°å¢æ”¯å‡º</h3>
                        <div class="space-y-3">
                            <input type="date" id="exp-date" value="${todayStr}" class="w-full p-3 bg-gray-50 border-none rounded-xl text-sm outline-none font-mono">
                            <div class="flex items-center gap-2 bg-amber-50 p-3 rounded-xl border border-amber-100 text-sm font-bold">
                                <span class="text-amber-700">åŒ¯ç‡:</span>
                                <input type="number" id="manual-rate" value="${currentRate}" step="0.001" onchange="updateRate(this.value)" class="flex-1 bg-transparent border-none outline-none text-amber-900 font-mono text-center">
                                <span class="text-[10px] text-amber-600">JPY/TWD</span>
                            </div>
                            <div class="flex items-center bg-gray-50 rounded-xl overflow-hidden border border-gray-100">
                                <div class="px-4 text-gray-400 font-bold text-xs">å¹£åˆ¥/é‡‘é¡</div>
                                <select id="exp-currency" class="bg-transparent py-3 px-2 outline-none font-bold text-gray-600 text-xs">
                                    <option value="TWD">TWD</option><option value="JPY">JPY</option>
                                </select>
                                <input type="number" id="exp-amount" placeholder="0" class="flex-1 bg-transparent p-3 outline-none text-right font-mono text-lg">
                            </div>
                            <input type="text" id="exp-desc" placeholder="é …ç›®å…§å®¹ (å¦‚: ç‡’è‚‰)" class="w-full p-3 bg-gray-50 border-none rounded-xl text-sm outline-none">
                            <div class="text-[10px] font-bold text-gray-400 tracking-widest mt-2 uppercase text-center">æ”¯ä»˜è€…</div>
                            <select id="exp-payer" class="w-full p-3 bg-gray-50 border-none rounded-xl text-sm outline-none text-center">${members.map(m => `<option value="${m}">${m}</option>`).join('')}</select>
                            <div class="text-[10px] font-bold text-gray-400 tracking-widest mt-2 uppercase text-center">åˆ†æ”¤å°è±¡</div>
                            <div class="flex justify-center gap-5 p-2">${members.map(m => `<label class="flex items-center gap-1 text-xs"><input type="checkbox" name="split-member" value="${m}" checked class="accent-red-500"> ${m}</label>`).join('')}</div>
                            <button onclick="addExpense()" class="w-full bg-red-500 text-white py-4 rounded-xl font-bold shadow-md active:scale-95 transition-all mt-2">å„²å­˜ç´€éŒ„</button>
                        </div>
                    </div>
                    <div class="bg-amber-50 p-5 rounded-2xl border border-amber-100"><h3 class="text-lg font-bold mb-4 text-amber-800 flex items-center justify-center"><i class="fas fa-calculator mr-2"></i> çµç®— (TWD)</h3><div class="space-y-2 text-sm">${balanceHtml}</div></div>
                    <div class="space-y-3 pb-10" id="expense-list">${renderExpenseList()}</div>
                </div>
            `;
        }

        function updateRate(val) { currentRate = parseFloat(val) || 0.215; localStorage.setItem('okinawa_jpy_rate', currentRate); }
        function calculateBalances() {
            let totals = {}; members.forEach(m => totals[m] = 0);
            expenses.forEach(exp => { const perPerson = exp.twdAmount / exp.splitWith.length; totals[exp.payer] += exp.twdAmount; exp.splitWith.forEach(m => { totals[m] -= perPerson; }); });
            return members.map(m => `<div class="flex justify-between font-bold bg-white p-3 rounded-lg shadow-sm"><span>${m}</span><span class="${Math.round(totals[m]) >= 0 ? 'text-green-600' : 'text-red-500'}">${Math.round(totals[m]) >= 0 ? 'æ‡‰æ”¶å›' : 'æ‡‰æ”¯ä»˜'} $${Math.abs(Math.round(totals[m]))}</span></div>`).join('');
        }
        function renderExpenseList() { if (expenses.length === 0) return '<div class="text-center text-gray-300 py-10 text-sm">å°šç„¡ç´€éŒ„</div>'; return expenses.map(exp => `<div class="bg-white p-4 rounded-xl shadow-sm border border-gray-100 flex justify-between items-center mb-2"><div><div class="text-[10px] text-gray-400 font-mono mb-1">${exp.date}</div><div class="text-sm font-bold text-gray-800">${exp.desc}</div><div class="text-[9px] text-gray-400 font-bold uppercase mt-1">${exp.payer} æ”¯ä»˜ ${exp.amount} ${exp.currency}</div></div><div class="text-right flex items-center gap-3"><span class="text-xs font-mono font-bold text-gray-600">â‰ˆ $${Math.round(exp.twdAmount)}</span><button onclick="deleteExpense(${exp.id})" class="text-gray-200 hover:text-red-400"><i class="fas fa-trash-alt"></i></button></div></div>`).join(''); }
        function addExpense() {
            const amount = parseFloat(document.getElementById('exp-amount').value); const currency = document.getElementById('exp-currency').value; const desc = document.getElementById('exp-desc').value; const payer = document.getElementById('exp-payer').value; const date = document.getElementById('exp-date').value; const checkedBoxes = document.querySelectorAll('input[name="split-member"]:checked'); const splitWith = Array.from(checkedBoxes).map(cb => cb.value);
            if (!amount || !desc || splitWith.length === 0) { alert('è«‹å¡«å¯«å®Œæ•´è³‡è¨Š'); return; }
            expenses.unshift({ id: Date.now(), date, amount, currency, twdAmount: (currency === 'JPY' ? amount * currentRate : amount), desc, payer, splitWith }); localStorage.setItem('okinawa_expenses', JSON.stringify(expenses)); renderLedger();
        }
        function deleteExpense(id) { expenses = expenses.filter(e => e.id !== id); localStorage.setItem('okinawa_expenses', JSON.stringify(expenses)); renderLedger(); }

        function showModal(itemStr) {
            const item = JSON.parse(decodeURIComponent(itemStr));
            const modal = document.getElementById('detail-modal');
            document.getElementById('modal-img').src = item.img;
            document.getElementById('modal-tag').textContent = item.tag || 'INFO';
            document.getElementById('modal-title').textContent = item.title;
            document.getElementById('modal-desc').textContent = item.desc;
            document.getElementById('modal-hours').querySelector('span').textContent = item.hours || 'ä¾ç¾å ´å…¬å‘Šç‚ºä¸»';
            const nc = document.getElementById('modal-notes-container');
            const pdfBtn = document.getElementById('modal-link-btn');
            if (item.notes) {
                const urlMatch = item.notes.match(/https?:\/\/[^\s]+/);
                if (urlMatch) {
                    document.getElementById('modal-pdf-link').href = urlMatch[0];
                    pdfBtn.classList.remove('hidden');
                    document.getElementById('modal-notes').textContent = item.notes.replace(urlMatch[0], '').trim();
                } else { pdfBtn.classList.add('hidden'); document.getElementById('modal-notes').textContent = item.notes; }
                nc.classList.remove('hidden');
            } else nc.classList.add('hidden');
            const mc = document.getElementById('modal-mapcode-btn');
            if (item.mapcode) { document.getElementById('modal-mapcode').textContent = item.mapcode; mc.classList.remove('hidden'); mc.onclick = () => { navigator.clipboard.writeText(item.mapcode); alert('MapCode å·²è¤‡è£½ï¼'); }; } else mc.classList.add('hidden');
            document.getElementById('modal-google-link').href = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(item.map || item.title)}`;
            modal.classList.remove('hidden'); setTimeout(() => { modal.classList.remove('opacity-0'); modal.querySelector('div').classList.remove('translate-y-full'); }, 10);
            document.body.style.overflow = 'hidden';
        }
        function closeModal() { const modal = document.getElementById('detail-modal'); modal.classList.add('opacity-0'); modal.querySelector('div').classList.add('translate-y-full'); setTimeout(() => { modal.classList.add('hidden'); document.body.style.overflow = ''; }, 300); }

        window.addEventListener('load', initApp);
    </script>
</body>
</html>
